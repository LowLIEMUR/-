<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbuz Perdun</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
        }
        #gameArea {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
        }
        #shop, #leaderboard, #dailyTasks {
            margin-top: 20px;
            background-color: #fff;
            border-radius: 10px;
            padding: 10px;
            width: 80%;
            max-width: 400px;
        }
    </style>
</head>
<body>
    <div id="gameArea">
        <h1>Arbuz Perdun</h1>
        <div id="loadingMessage">Loading...</div>
        <button id="tapButton" style="display: none;">üçâ Tap Me!</button>
        <div id="stats" style="display: none;">
            <p>Taps: <span id="tapCount">0</span></p>
            <p>Taps per second: <span id="tapsPerSecond">0</span></p>
        </div>
    </div>
    
    <div id="dailyTasks" style="display: none;">
        <h2>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h2>
        <ul id="taskList"></ul>
    </div>
    
    <div id="shop" style="display: none;">
        <h2>–ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h2>
        <ul id="upgradeList"></ul>
    </div>
    
    <div id="leaderboard" style="display: none;">
        <h2>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
        <ol id="leaderboardList"></ol>
    </div>

    <script>
        let taps = 0;
        let tapsPerSecond = 0;
        let upgrades = [];
        let dailyTasks = [];
        let leaderboard = [];
        let userId = null;

        $(document).ready(function() {
            $('#loadingMessage').hide();
            $('#tapButton, #stats, #shop, #dailyTasks, #leaderboard').show();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π userId –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            userId = Math.random().toString(36).substring(7);
            
            loadGame();
            initializeUpgrades();
            initializeDailyTasks();
            updateLeaderboard();
            
            setInterval(autoTap, 1000);
            setInterval(saveGame, 5000);  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        });

        $('#tapButton').click(function() {
        taps++;
        updateStats();
        checkTaskCompletion();
        sendTapsToBot(); // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∞–ø–∞—Ö
    });

        function autoTap() {
            taps += tapsPerSecond;
            updateStats();
        }

        function updateStats() {
            $('#tapCount').text(taps);
            $('#tapsPerSecond').text(tapsPerSecond.toFixed(1));
        }

        function initializeUpgrades() {
            upgrades = [
                { name: "–ê–≤—Ç–æ–∫–ª–∏–∫", cost: 10, tpsIncrease: 0.1, owned: 0 },
                { name: "–°—É–ø–µ—Ä –ø–∞–ª–µ—Ü", cost: 50, tpsIncrease: 0.5, owned: 0 },
                { name: "–ê—Ä–±—É–∑–Ω—ã–π —É—Å–∫–æ—Ä–∏—Ç–µ–ª—å", cost: 200, tpsIncrease: 2, owned: 0 }
            ];
            
            updateShopDisplay();
        }
        function sendTapsToBot() {
        $.ajax({
        url: 'mongodb://localhost:27017', // URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ userId: YOUR_USER_ID, taps: taps }), // –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_USER_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π userId
        success: function(response) {
            console.log('Taps sent to bot:', response);
        },
        error: function(error) {
            console.error('Error sending taps to bot:', error);
                }
            });
        }
        function loadTapsFromBot() {
        $.ajax({
        url: 'mongodb://localhost:27017', // URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        method: 'GET',
        success: function(response) {
            taps = response.taps; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º taps
            updateStats();
        },
        error: function(error) {
            console.error('Error loading taps from bot:', error);
                }
            });
        }
        function buyUpgrade(index) {
            let upgrade = upgrades[index];
            if (taps >= upgrade.cost) {
                taps -= upgrade.cost;
                upgrade.owned++;
                tapsPerSecond += upgrade.tpsIncrease;
                upgrade.cost = Math.floor(upgrade.cost * 1.5);
                updateStats();
                updateShopDisplay();
            } else {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–∞–ø–æ–≤!");
            }
        }

        function updateShopDisplay() {
            let upgradeList = $('#upgradeList');
            upgradeList.empty();
            upgrades.forEach((upgrade, index) => {
                upgradeList.append(`
                    <li>
                        ${upgrade.name} - –°—Ç–æ–∏–º–æ—Å—Ç—å: ${upgrade.cost} —Ç–∞–ø–æ–≤
                        <button onclick="buyUpgrade(${index})">–ö—É–ø–∏—Ç—å</button>
                        <span>–ö—É–ø–ª–µ–Ω–æ: ${upgrade.owned}</span>
                    </li>
                `);
            });
        }

        function initializeDailyTasks() {
            dailyTasks = [
                { description: "–ù–∞–±—Ä–∞—Ç—å 100 —Ç–∞–ø–æ–≤", goal: 100, progress: 0, completed: false },
                { description: "–ö—É–ø–∏—Ç—å 5 —É–ª—É—á—à–µ–Ω–∏–π", goal: 5, progress: 0, completed: false },
                { description: "–î–æ—Å—Ç–∏—á—å 10 —Ç–∞–ø–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É", goal: 10, progress: 0, completed: false }
            ];
            
            updateTaskDisplay();
        }

        function updateTaskDisplay() {
            let taskList = $('#taskList');
            taskList.empty();
            dailyTasks.forEach((task, index) => {
                taskList.append(`
                    <li>
                        ${task.description} - –ü—Ä–æ–≥—Ä–µ—Å—Å: ${task.progress}/${task.goal}
                        ${task.completed ? '‚úÖ' : ''}
                    </li>
                `);
            });
        }

        function checkTaskCompletion() {
            dailyTasks[0].progress = taps;
            dailyTasks[1].progress = upgrades.reduce((sum, upgrade) => sum + upgrade.owned, 0);
            dailyTasks[2].progress = tapsPerSecond;
            
            dailyTasks.forEach(task => {
                if (task.progress >= task.goal) {
                    task.completed = true;
                }
            });
            
            updateTaskDisplay();
        }

        function updateLeaderboard() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            leaderboard = [
                { name: "Player1", score: 1000 },
                { name: "Player2", score: 800 },
                { name: "Player3", score: 600 },
            ];
            
            let leaderboardList = $('#leaderboardList');
            leaderboardList.empty();
            leaderboard.forEach(player => {
                leaderboardList.append(`<li>${player.name} - ${player.score} —Ç–∞–ø–æ–≤</li>`);
            });
        }

        function saveGame() {
            let gameState = {
                t: taps,
                tps: tapsPerSecond,
                u: upgrades.map(u => u.owned),
                dt: dailyTasks.map(t => t.completed ? 1 : 0)
            };

            $.ajax({
                url: '/save',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ userId, gameState }),
                success: function(response) {
                    console.log('Game saved successfully');
                },
                error: function(error) {
                    console.error('Error saving game:', error);
                }
            });
        }

            function loadGame() {
        let userId = YOUR_USER_ID; // –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_USER_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π userId
        $.ajax({
        url: `localhost:27017/${userId}`, // URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        method: 'GET',
        success: function(response) {
            if (response.gameState) {
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –∏–∑ response.gameState
                taps = response.gameState.taps || 0;
                tapsPerSecond = response.gameState.tapsPerSecond || 0;
                upgrades = response.gameState.upgrades || [];
                dailyTasks = response.gameState.dailyTasks || [];
                updateStats();
                updateShopDisplay();
                updateTaskDisplay();
                }
            },
            error: function(error) {
            console.error('Error loading game state:', error);
                    }
                });
            }
    </script>
</body>
</html>
